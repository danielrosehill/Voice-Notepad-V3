# Release Notes: v1.9.5

**Release Date**: December 25, 2024

## Summary

This release validates and documents **Text Injection** for Wayland, enabling automatic pasting of transcribed text at the cursor position. Previously marked as "Beta", the feature is now fully supported with comprehensive documentation and a setup script.

## Validated Environment

Text injection has been tested and validated on:
- **OS**: Ubuntu 25.10
- **Desktop Environment**: KDE Plasma 6
- **Display Server**: Wayland
- **ydotool version**: 1.0.4

## What's New

### Text Injection (Wayland Support)

Text injection allows Voice Notepad to automatically paste transcribed text wherever your cursor is focused. This eliminates the need to manually Ctrl+V after each transcription.

**How it works:**
1. You record audio and transcribe it
2. The transcription is copied to the clipboard (using `wl-copy`)
3. A simulated Ctrl+V keystroke is sent (using `ydotool`)
4. The text appears at your cursor position

### Setup Script

A new setup script automates the configuration process:

```bash
./scripts/setup-text-injection.sh
```

The script:
- Detects your environment (OS, desktop, Wayland/X11)
- Checks if ydotool is installed (offers to install if missing)
- Verifies the daemon is running with correct permissions
- Provides remediation commands with user approval

### Documentation

New comprehensive documentation at `docs/text-injection.md` covers:
- Why Wayland makes keyboard simulation challenging
- Quick setup steps
- Making the configuration persistent (survives reboot)
- Troubleshooting common issues
- Comparison with alternative tools

## Important: ydotool Daemon Setup

The key insight for reliable text injection on Wayland:

**The ydotool daemon must run as your user, not as root.**

Many Linux distributions start `ydotoold` as a system service (running as root), which creates a socket that regular users cannot access. This causes the "ydotoold backend unavailable" warning.

### Quick Fix

```bash
# Stop root-owned daemon and remove stale socket
sudo pkill ydotoold
sudo rm -f /tmp/.ydotool_socket

# Start daemon as your user
ydotoold &
```

### Persistent Setup

To start ydotoold automatically on login, create a systemd user service:

```bash
mkdir -p ~/.config/systemd/user

cat > ~/.config/systemd/user/ydotoold.service << 'EOF'
[Unit]
Description=ydotool daemon

[Service]
ExecStart=/usr/bin/ydotoold

[Install]
WantedBy=default.target
EOF

systemctl --user daemon-reload
systemctl --user enable --now ydotoold
```

## UI Changes

- Removed "(Beta)" label from Text Injection checkbox
- Updated tooltip to reference setup documentation

## Files Changed

- `app/src/main.py` - Removed Beta label, updated tooltip
- `app/src/text_injection.py` - Simplified to use ydotool directly, added socket discovery
- `docs/text-injection.md` - New comprehensive setup guide
- `docs/troubleshooting.md` - Added Text Injection section
- `docs/index.md` - Added link to text injection guide
- `scripts/setup-text-injection.sh` - New automated setup script

## Upgrade Notes

No breaking changes. Users upgrading from previous versions:
1. Run `./scripts/setup-text-injection.sh` to verify your setup
2. Enable "Text Injection" in the main window
3. Ensure ydotoold is running as your user (not root)

## Known Limitations

- **X11**: Not tested on X11; may work differently
- **GNOME/Sway/Hyprland**: Should work but not validated
- **wtype**: Does not work on KDE Plasma (compositor doesn't support virtual keyboard protocol)
- **xdotool**: X11 only, does not work on Wayland
